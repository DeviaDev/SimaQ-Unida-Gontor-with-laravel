@extends('layouts/app') 
@section('content') 
<div class="container-fluid"> {{-- Judul Halaman --}} <h1 class="h3 mb-4 text-gray-800"> <i class="fas fa-user mr-2"></i> {{ $title }} </h1> {{-- Filter Prodi & Semester --}} <div class="card shadow-sm mb-4"> <div class="card-body"> @php $hasProdi = request()->filled('prodi'); $hasSemester = request()->filled('semester'); $hasKelompok = request()->filled('kelompok'); $isComplete = $hasProdi && $hasSemester && $hasKelompok; @endphp {{-- Filter Prodi --}} <h6 class="text-muted mb-2"> <i class="fas fa-filter mr-1"></i> Filter Program Studi </h6> <div class="d-flex flex-wrap mb-4" style="gap: .5rem;"> @php $prodi = [ 'PAI','PBA','TBI','PBA INTERNASIONAL','IQT','AFI','PMH','HES','MB','EI','HI', 'ILKOM', 'TI', 'AGRO','GIZI','FARM' ]; @endphp @foreach ($prodi as $p) <a href="?prodi={{ $p }}&semester={{ request('semester') }}" class="btn btn-sm btn-outline-primary {{ request('prodi') == $p ? 'active' : '' }}"> {{ $p }} </a> @endforeach </div> {{-- Filter Semester --}} <h6 class="text-muted mb-2"> <i class="fas fa-layer-group mr-1"></i> Filter Semester </h6> <div class="d-flex flex-wrap" style="gap: .5rem;"> @for ($s = 1; $s <= 8; $s++) <a href="?prodi={{ request('prodi') }}&semester={{ $s }}" class="btn btn-sm btn-outline-success {{ request('semester') == $s ? 'active' : '' }}"> Semester {{ $s }} </a> @endfor </div> {{-- Filter Kelompok --}} @if(!empty($kelompokList) && count($kelompokList) > 0) <h6 class="text-muted mt-4 mb-2"> <i class="fas fa-users mr-1"></i> Filter Kelompok </h6> <div class="d-flex flex-wrap" style="gap: .5rem;"> @foreach ($kelompokList as $k) <a href="?prodi={{ request('prodi') }} &semester={{ request('semester') }} &kelompok={{ $k }}" class="btn btn-sm btn-outline-warning {{ request('kelompok') == $k ? 'active' : '' }}"> Kelompok {{ $k }} </a> @endforeach </div> @endif </div> </div> {{-- Konten Absensi --}} <div class="card shadow"> <div class="card-body"> @if(request('prodi') || request('semester')) <div class="d-flex align-items-center flex-wrap mb-3" style="gap: .5rem;"> <h5 class="mb-0 mr-2"> Data Absensi </h5> {{-- Prodi aktif --}} @if(request('prodi')) <a href="?semester={{ request('semester') }}" class="btn btn-sm btn-primary"> {{ request('prodi') }} <span class="ml-1">&times;</span> </a> @endif {{-- Semester aktif --}} @if(request('semester')) <a href="?prodi={{ request('prodi') }}" class="btn btn-sm btn-success"> Semester {{ request('semester') }} <span class="ml-1">&times;</span> </a> @endif @if(request('kelompok')) <a href="?prodi={{ request('prodi') }}&semester={{ request('semester') }}" class="btn btn-sm btn-warning"> Kelompok {{ request('kelompok') }} <span class="ml-1">&times;</span> </a> @endif {{-- Clear All --}} <a href="{{ url()->current() }}" class="btn btn-sm btn-outline-danger"> Clear </a> </div> @endif @php use Carbon\Carbon; $selectedDate = request('tanggal') ? Carbon::parse(request('tanggal')) : null; $days = []; if ($selectedDate) { // 4 kolom: 3 kosong + tanggal terpilih for ($i = 3; $i >= 1; $i--) { $days[] = null; } $days[] = $selectedDate; } @endphp @if(!$selectedDate) <div class="alert alert-info d-flex align-items-center"> <i class="fas fa-calendar mr-2"></i> Pilih <strong> tanggal absensi </strong> terlebih dahulu untuk mengisi kehadiran. </div> @endif @if($isComplete) @php $selectedDate = request('tanggal'); @endphp <div class="mb-3 d-flex align-items-center justify-content-between flex-wrap" style="gap:1rem;"> {{-- KALENDER --}} <div class="d-flex align-items-center" style="gap:.5rem;"> <label class="mb-0 text-muted"> <i class="fas fa-calendar-alt mr-1"></i> Tanggal Absensi </label> <input type="date" id="tanggal-absensi" class="form-control form-control-sm tanggal-picker" style="width: 180px" value="{{ $selectedDate }}" onchange="window.location.href='?{{ http_build_query(array_merge(request()->except('tanggal'), ['tanggal' => ''])) }}'+this.value"> </div> {{-- ABSENSI ALL --}} <div class="btn-group btn-group-sm absensi-all-wrapper"> <button class="btn btn-outline-success btn-absen-all" data-status="hadir">Hadir All</button> <button class="btn btn-outline-warning btn-absen-all" data-status="izin">Izin All</button> <button class="btn btn-outline-danger btn-absen-all" data-status="sakit">Sakit All</button> </div> </div> <table class="table table-bordered table-hover text-center align-middle"> <thead class="thead-light"> <tr> <th>No</th> <th class="text-left">Nama</th> <th>Status Hari Ini</th> {{-- 4 hari terakhir --}} @foreach($days as $index => $d) <th> @if($d && $index === 3) <div class="d-flex flex-column align-items-center" style="gap:4px"> <div>{{ $d->format('d/m/Y') }}</div> </div> @else — @endif </th> @endforeach <th>Total Hadir</th> </tr> </thead> <tbody> @forelse($mahasiswi as $m) <tr> <td>{{ $loop->iteration }}</td> <td class="text-left">{{ $m->nama }}</td> {{-- STATUS HARI INI --}} <td> <div class="btn-group btn-group-sm attendance-btns" data-id="{{ $m->id ?? $loop->iteration }}"> <button type="button" class="btn btn-outline-success" data-status="hadir" {{ !$selectedDate ? 'disabled' : '' }}> Hadir </button> <button type="button" class="btn btn-outline-warning" data-status="izin" {{ !$selectedDate ? 'disabled' : '' }}> Izin </button> <button type="button" class="btn btn-outline-danger" data-status="sakit" {{ !$selectedDate ? 'disabled' : '' }}> Sakit </button> </div> {{-- hidden input sementara --}} <input type="hidden" class="attendance-value" value=""> </td> {{-- RIWAYAT 4 HARI --}} @foreach($days as $index => $d) <td> @if($index === 3) {{-- pertemuan 1 (hari ini) --}} <span class="badge badge-light">—</span> @else {{-- pertemuan selanjutnya belum ada --}} <span class="text-muted">—</span> @endif </td> @endforeach {{-- TOTAL HADIR --}} <td> <span class="badge badge-secondary total-hadir">0</span> </td> {{-- DATA TETAP ADA --}} <input type="hidden" value="{{ $m->prodi }}"> <input type="hidden" value="{{ $m->semester }}"> <input type="hidden" value="{{ $m->kelompok }}"> </tr> @empty <tr> <td colspan="8" class="text-muted"> Data tidak ditemukan </td> </tr> @endforelse </tbody> </table> @endif </div> </div> @if(!$isComplete) <div class="alert alert-warning d-flex align-items-center"> <i class="fas fa-info-circle mr-2"></i> <span> @if(!$hasProdi && !$hasSemester && !$hasKelompok) Silakan pilih <strong>Program Studi</strong>, <strong>Semester</strong>, dan <strong>Kelompok</strong> terlebih dahulu. @elseif($hasProdi && !$hasSemester) Silakan pilih <strong>Semester</strong>. @elseif($hasProdi && $hasSemester && !$hasKelompok) Silakan pilih <strong>Kelompok</strong>. @elseif(!$hasProdi && $hasSemester) Silakan pilih <strong>Program Studi</strong>. @else Lengkapi filter terlebih dahulu. @endif </span> </div> @endif </div> @push('scripts') <script> function submitAbsensi(button, status) { const group = button.closest('.attendance-btns'); const row = group.closest('tr'); const mahasiswiId = group.dataset.id; const tanggal = "{{ request('tanggal') }}"; fetch("{{ route('absensi.simpan') }}", { method: "POST", headers: { "Content-Type": "application/json", "X-CSRF-TOKEN": "{{ csrf_token() }}" }, body: JSON.stringify({ mahasiswi_id: mahasiswiId, tanggal: tanggal, status: status }) }) .then(res => res.json()) .then(data => { if (!data.success) return; // reset tombol group.querySelectorAll('button').forEach(b => { b.classList.remove('btn-success', 'btn-warning', 'btn-danger'); b.classList.add( b.dataset.status === 'hadir' ? 'btn-outline-success' : b.dataset.status === 'izin' ? 'btn-outline-warning' : 'btn-outline-danger' ); }); // aktifkan terpilih const activeBtn = group.querySelector([data-status="${status}"]); activeBtn.classList.remove('btn-outline-success', 'btn-outline-warning', 'btn-outline-danger'); if (status === 'hadir') activeBtn.classList.add('btn-success'); if (status === 'izin') activeBtn.classList.add('btn-warning'); if (status === 'sakit') activeBtn.classList.add('btn-danger'); // update kolom tanggal const cells = row.querySelectorAll('td'); const pertemuan = data.pertemuan; const pertemuanIndex = 2 + pertemuan; // sesuaikan index kolom const cell = row.querySelectorAll('td')[pertemuanIndex]; cell.innerHTML = <span class="badge badge-info">${status}</span>; // update total hadir const totalBadge = row.querySelector('.total-hadir'); totalBadge.textContent = data.total_hadir; totalBadge.className = 'badge ' + (data.total_hadir > 0 ? 'badge-success' : 'badge-secondary') + ' total-hadir'; }); } document.addEventListener('DOMContentLoaded', function () { console.log('JS READY'); document.querySelectorAll('.attendance-btns button').forEach(btn => { btn.addEventListener('click', function () { console.log('BUTTON CLICKED'); if (this.hasAttribute('disabled')) { console.log('BUTTON DISABLED'); return; } if (this.hasAttribute('disabled')) return; submitAbsensi(this, this.dataset.status); }); }); }); document.querySelectorAll('.btn-absen-all').forEach(btn => { btn.addEventListener('click', function () { const status = this.dataset.status; document.querySelectorAll('.attendance-btns').forEach(group => { const button = group.querySelector([data-status="${status}"]); submitAbsensi(button, status); }); }); }); document.addEventListener('DOMContentLoaded', function () { const tanggalInput = document.getElementById('tanggal-absensi'); const allWrapper = document.querySelector('.absensi-all-wrapper'); if (tanggalInput && tanggalInput.value) { allWrapper.classList.add('active'); tanggalInput.classList.add('has-value'); } }); </script> @endpush @endsection <style> /* default (belum pilih tanggal) */ .absensi-all-wrapper button { opacity: 0.5; pointer-events: none; } /* kalau tanggal dipilih */ .absensi-all-wrapper.active button { opacity: 1; pointer-events: auto; } /* kalender transparan */ .tanggal-picker { background-color: transparent; border: 1px solid #ced4da; } /* kalender aktif */ .tanggal-picker.has-value { background-color: #fff; } </style>